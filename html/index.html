<!DOCTYPE html>
<html>
	<head>
		<title>BLÃ…HAJ finder</title>
		<link
			rel="icon"
			type="image/png"
			sizes="32x32"
			href="favicon-32x32.png"
		/>
		<link
			rel="icon"
			type="image/png"
			sizes="16x16"
			href="favicon-16x16.png"
		/>
		<meta name="msapplication-TileColor" content="#468293" />
		<!-- <meta name="msapplication-config" content="/assets/icons/browserconfig.xml"> -->
		<meta name="theme-color" content="#468293" />
		<meta name="description" content="Hourly BLÃ…HAJ finder map" />
		<meta
			property="og:url"
			content="https://makitsune.github.io/blahaj-finder/"
		/>
		<meta property="og:type" content="website" />
		<meta property="og:title" content="BLÃ…HAJ finder ðŸ¦ˆ" />
		<meta property="og:description" content="Hourly BLÃ…HAJ finder map" />
		<meta
			property="og:image"
			content="https://makitsune.github.io/blahaj-finder/img/full-flipped.png"
		/>
		<meta
			property="twitter:url"
			content="https://makitsune.github.io/blahaj-finder/"
		/>
		<meta name="twitter:title" content="BLÃ…HAJ finder ðŸ¦ˆ" />
		<meta name="twitter:description" content="Hourly BLÃ…HAJ finder map" />
		<meta
			name="twitter:image"
			content="https://makitsune.github.io/blahaj-finder/img/full-flipped.png"
		/>
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;700&display=swap"
			rel="stylesheet"
		/>
		<link
			rel="stylesheet"
			href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"
			integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ=="
			crossorigin=""
		/>
		<script
			src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
			integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
			crossorigin=""
		></script>
		<script src="https://unpkg.com/heatmap.js@2.0.5/build/heatmap.js"></script>
		<script src="leaflet-heatmap.js"></script>
		<script async defer src="https://buttons.github.io/buttons.js"></script>
		<style>
			* {
				margin: 0;
			}

			body {
				overflow: hidden;
				font-family: "Noto Sans", sans-serif;
			}

			#map {
				width: 100vw;
				height: calc(100vh - 48px);
			}

			.header {
				width: 100vw;
				height: 48px;
				display: flex;
				align-items: center;
				justify-content: flex-start;
				flex-direction: row;
				color: #fff;
				background-image: linear-gradient(
						0deg,
						rgba(29, 31, 33, 0.3),
						rgba(29, 31, 33, 0.3)
					),
					linear-gradient(0deg, #468293, #468293);
			}

			.icon {
				width: 128px;
				height: 48px;
				background-image: url("img/full-flipped.png");
				background-size: cover;
				background-position: 50% 60%;
			}

			.title {
				font-size: 1.6rem;
				margin-left: 16px;
				margin-top: -4px;
			}

			.title a {
				text-decoration: none;
				color: #fff;
			}
		</style>
	</head>
	<body>
		<div class="header">
			<div class="icon"></div>
			<h1 class="title">
				<a
					href="https://www.ikea.com/us/en/p/blahaj-soft-toy-shark-90373590/"
				>
					BLÃ…HAJ finder
				</a>
			</h1>
			<p style="margin-left: 32px">
				Last updated: <b id="updated">loading...</b>
				<span style="opacity: 0.6">(updates hourly)</span>
			</p>
			<p style="margin-left: 32px">
				<b><span id="total-stores"></span> stores</b> indexed
			</p>
			<div style="flex-grow: 1"></div>
			<a
				href="https://maki.cafe"
				style="color: #fff; text-decoration: none; margin-right: 16px"
			>
				Made by <b>Maki</b>
			</a>
			<span style="margin-right: 12px">
				<a
					class="github-button"
					href="https://github.com/makitsune/blahaj-finder"
					data-color-scheme="no-preference: light; light: light; dark: light;"
					data-size="large"
					data-show-count="true"
					aria-label="Star makitsune/blahaj-finder on GitHub"
				>
					Star
				</a>
			</span>
		</div>
		<div id="map"></div>
		<script>
			const map = L.map("map").setView([20, 0], 3);

			L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
				attribution:
					'&copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap contributors</a>',
				maxZoom: 19,
			}).addTo(map);

			(async () => {
				const res = await fetch("blahaj.json?" + Date.now());
				const blahajData = await res.json();

				const updated = new Date(blahajData.updated);
				document.getElementById("updated").textContent =
					updated.toLocaleString();

				document.getElementById("total-stores").textContent =
					blahajData.data.length;

				const heatmapLayer = new HeatmapOverlay({
					radius: 1.5,
					maxOpacity: 0.7,
					scaleRadius: true,
					useLocalExtrema: true,
					latField: "lat",
					lngField: "lng",
					valueField: "quantity",
				});
				heatmapLayer.setData({ data: blahajData.data });
				heatmapLayer.addTo(map);

				for (let store of blahajData.data) {
					L.marker([store.lat, store.lng])
						.bindPopup(
							store.name + ": " + store.quantity + " blahaj",
						)
						.addTo(map);
				}
			})();
		</script>
	</body>
</html>
